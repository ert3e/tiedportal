//
//  OfferParkingController.m
//  Ecopark
//
//  Created by Samiflabs on 31/08/16.
//  Copyright Â© 2016 Samiflabs. All rights reserved.
//

#import "OfferParkingController.h"
#import "Comman.h"

@interface OfferParkingController ()
{
    UIAlertController *alertController;
    NSString *pathImage1,*pathImage2,*pathImage3,*pathImage4,*loc_lat,*loc_long;
    int flag;
    NSMutableArray *arrDays;
    UITableView *alertTableView;
}
@end
@implementation OfferParkingController
@synthesize BTImage1,BTImage2,BTImage3;
@synthesize LBFrom,LBDays,LBTo,tblOffer;
- (void)viewDidLoad {
    [super viewDidLoad];
    
    [self initController];
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

-(void)initController
{
    NSArray *items = [[NSArray alloc]initWithObjects:BTImage1,BTImage2,BTImage3, nil];
    if (IDIOM == IPAD)
    {
        for (int i=0; i<items.count; i++)
        {
            [[items [i]layer] setBorderWidth:3];
            [[items [i]layer] setBorderColor:[UIColor lightGrayColor].CGColor];
            [[items [i]layer] setMasksToBounds:YES];
        }
    }
    else
    {
        for (int i=0; i<items.count; i++)
        {
            [[items [i]layer] setBorderWidth:1.5];
            [[items [i]layer] setBorderColor:[UIColor lightGrayColor].CGColor];
            [[items [i]layer] setMasksToBounds:YES];
        }
    }
    
    //    CGRect frame = TFPlaceName.frame;
    //
    //    UIView *paddingView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 5, frame.size.height)];
    //    TFPlaceName.leftView = paddingView;
    //    TFPlaceName.leftViewMode = UITextFieldViewModeAlways;
    //
    //    [TVPlaceDetails setTextColor:[UIColor lightGrayColor]];
    //    [TVPlaceDetails  setTextContainerInset:UIEdgeInsetsMake(5, 5, 0, 0)];
}

#pragma mark - ImageController
-(void)showImagePicker:(NSInteger)btnTag
{
    alertController = [UIAlertController alertControllerWithTitle:@"Attach image" message:@"" preferredStyle:UIAlertControllerStyleActionSheet];
    [alertController.view setTag:btnTag];
    UIAlertAction* pickFromGallery = [UIAlertAction actionWithTitle:@"Take a photo"
                                                              style:UIAlertActionStyleDefault
                                                            handler:^(UIAlertAction * action) {
                                                                if([UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera])
                                                                {
                                                                    UIImagePickerController* picker = [[UIImagePickerController alloc] init];
                                                                    picker.sourceType = UIImagePickerControllerSourceTypeCamera;
                                                                    picker.delegate = self;
                                                                    
                                                                    [self presentViewController:picker animated:YES completion:NULL];
                                                                }
                                                                
                                                            }];
    UIAlertAction* takeAPicture = [UIAlertAction actionWithTitle:@"Choose from gallery"
                                                           style:UIAlertActionStyleDefault
                                                         handler:^(UIAlertAction * action) {
                                                             UIImagePickerController* picker = [[UIImagePickerController alloc] init];
                                                             picker.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;
                                                             picker.delegate = self;
                                                             [self presentViewController:picker animated:YES completion:NULL];
                                                         }];
    UIAlertAction* cancel = [UIAlertAction actionWithTitle:@"Cancel"
                                                     style:UIAlertActionStyleCancel
                                                   handler:^(UIAlertAction * action) {
                                                   }];
    
    [alertController addAction:pickFromGallery];
    [alertController addAction:takeAPicture];
    [alertController addAction:cancel];
    
    if (IDIOM == IPAD) {
        // The following lines are needed for use with the iPad.
        UIPopoverPresentationController *alertPopoverPresentationController = alertController.popoverPresentationController;
        UIButton *imagePickerButton = BTImage1;
        alertPopoverPresentationController.sourceRect = imagePickerButton.frame;
        alertPopoverPresentationController.sourceView = self.view;
        
        [self showDetailViewController:alertController sender:imagePickerButton];
        
    }else
    {
        [self presentViewController:alertController animated:YES completion:nil];
    }
}

-(void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary<NSString *,id> *)info
{
    NSLog(@"Info %@",info);
    
    UIImage *imagePicked = info[UIImagePickerControllerOriginalImage];
    NSString *strFullImage;
    
    NSString *mediaType = [info objectForKey:UIImagePickerControllerMediaType];
    if ([mediaType isEqualToString:@"public.image"])
    {
        strFullImage = [info valueForKey:@"UIImagePickerControllerReferenceURL"];
        flag = 1;
        
        if (alertController.view.tag == 1)
        {
            [BTImage1 setBackgroundImage:imagePicked forState:UIControlStateNormal];
            pathImage1 = strFullImage;
        }
        else if (alertController.view.tag == 2)
        {
            [BTImage2 setBackgroundImage:imagePicked forState:UIControlStateNormal];
            pathImage2 = strFullImage;
        }
        else if (alertController.view.tag == 3)
        {
            [BTImage3 setBackgroundImage:imagePicked forState:UIControlStateNormal];
            pathImage3 = strFullImage;
        }
    }else {
        flag = 0;
    }
    
    [picker dismissViewControllerAnimated:YES completion:nil];
    if (flag == 0) {
        
        [self showAlert:ALERT_VALIDATION_TITLE message:ALERT_VALIDATION_MESSAGE okBTN:ALERT_OK cancelBTN:nil];
    }
}

-(void)imagePickerControllerDidCancel:(UIImagePickerController *)picker
{
    [picker dismissViewControllerAnimated:YES completion:nil];
}

#pragma mark - Alert
-(void)showAlert:(NSString *)title message:(NSString*)message okBTN:(NSString*)okBTN cancelBTN:(NSString*)cancelBTN
{
    
    UIAlertController * alert = [UIAlertController alertControllerWithTitle:title message:message preferredStyle:UIAlertControllerStyleAlert];
    UIAlertAction *ok = [UIAlertAction actionWithTitle:@"OK"
                                                 style:UIAlertActionStyleDefault
                                               handler:^(UIAlertAction * action) {
                                                   if([UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera])
                                                   {
                                                       [self dismissViewControllerAnimated:YES completion:nil];
                                                   }
                                               }];
    [alert addAction:ok];
    
    if (cancelBTN!=nil)
    {
        UIAlertAction* cancel = [UIAlertAction actionWithTitle:@"Cancel"
                                                         style:UIAlertActionStyleCancel
                                                       handler:^(UIAlertAction * action) {
                                                           [self dismissViewControllerAnimated:YES completion:nil];
                                                       }];
        [alert addAction:cancel];
    }
    
    [self presentViewController:alert animated:YES completion:nil];
    
}

- (IBAction)BTImage1Tap:(id)sender {
    [self showImagePicker:1];
}

- (IBAction)BTImage2Tap:(id)sender {
    [self showImagePicker:2];
    
}

- (IBAction)BTImage3Tap:(id)sender {
    [self showImagePicker:3];
}

- (IBAction)BTFromTap:(id)sender {
    [self datePickerController:sender lbl:LBFrom message:@"From"];
}

- (IBAction)BTToTap:(id)sender {
    [self datePickerController:sender lbl:LBTo message:@"Until"];
}

- (IBAction)BTDayTap:(id)sender {
    dispatch_async(dispatch_get_main_queue(), ^{
        TimePickerController *controller = [self.storyboard instantiateViewControllerWithIdentifier:@"TimePickerController"];
        [self.navigationController pushViewController:controller animated:true];
    });
    //    [self showDayPicker];
}

-(void)datePickerController:(id)sender lbl:(UILabel*)lbl message:(NSString *)message
{
    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@"\n\n\n\n\n\n\n\n\n\n\n" message:@"Select Time" preferredStyle:UIAlertControllerStyleActionSheet];
    UIDatePicker *picker = [[UIDatePicker alloc] init];
    [picker setDatePickerMode:UIDatePickerModeTime];
    [alertController.view addSubview:picker];
    [alertController addAction:({
        UIAlertAction *action = [UIAlertAction actionWithTitle:@"OK" style:UIAlertActionStyleDefault handler:^(UIAlertAction *action) {
            NSDateFormatter *df = [[NSDateFormatter alloc] init];
            [df setDateFormat:@"hh:mm a"];
            NSString *formattedDate = [df stringFromDate:picker.date];
            // btn.titleLabel.text =[NSString stringWithFormat:@"%@: %@",label,formattedDate];
            //[btn setTitle:[NSString stringWithFormat:@" %@",formattedDate] forState:UIControlStateNormal];
            
            lbl.text = [NSString stringWithFormat:@"%@ %@",message,formattedDate];
            NSLog(@"%@",[NSString stringWithFormat:@" %@",formattedDate]);
        }];
        action;
    })];
    [alertController addAction:({
        UIAlertAction *action = [UIAlertAction actionWithTitle:@"Cancel" style:UIAlertActionStyleDestructive handler:^(UIAlertAction *action) {
            NSLog(@"Cancel");
        }];
        action;
    })];
    
    UIPopoverPresentationController *popoverController = alertController.popoverPresentationController;
    popoverController.sourceView = sender;
    popoverController.sourceRect = [sender bounds];
    [self presentViewController:alertController  animated:YES completion:nil];
}

-(void)showDayPicker
{
    UIAlertController *alertview=   [UIAlertController
                                     alertControllerWithTitle:@"Select Days Availability "
                                     message:nil
                                     preferredStyle:UIAlertControllerStyleAlert];
    [alertview.view setTintColor:[UIColor blackColor]];
    UIAlertAction *oneDays = [UIAlertAction
                              actionWithTitle:@"Sundays"
                              style:UIAlertActionStyleDefault
                              handler:^(UIAlertAction * action)
                              {
                                  LBDays.text = [NSString stringWithFormat:@"1 Days"];
                                  [alertview dismissViewControllerAnimated:YES completion:nil];
                              }];
    UIAlertAction *twoDays = [UIAlertAction
                              actionWithTitle:@"2 Days"
                              style:UIAlertActionStyleDefault
                              handler:^(UIAlertAction * action)
                              {
                                  LBDays.text = [NSString stringWithFormat:@"2 Days"];
                                  [alertview dismissViewControllerAnimated:YES completion:nil];
                              }];
    UIAlertAction *threeDays = [UIAlertAction
                                actionWithTitle:@"3 Days"
                                style:UIAlertActionStyleDefault
                                handler:^(UIAlertAction * action)
                                {
                                    LBDays.text = [NSString stringWithFormat:@"3 Days"];
                                    [alertview dismissViewControllerAnimated:YES completion:nil];
                                }];
    UIAlertAction *fourDays = [UIAlertAction
                               actionWithTitle:@"4 Days"
                               style:UIAlertActionStyleDefault
                               handler:^(UIAlertAction * action)
                               {
                                   LBDays.text = [NSString stringWithFormat:@"4 Days"];
                                   [alertview dismissViewControllerAnimated:YES completion:nil];
                               }];
    UIAlertAction *fiveDays = [UIAlertAction
                               actionWithTitle:@"5 Days"
                               style:UIAlertActionStyleDefault
                               handler:^(UIAlertAction * action)
                               {
                                   LBDays.text = [NSString stringWithFormat:@"5 Days"];
                                   [alertview dismissViewControllerAnimated:YES completion:nil];
                               }];
    UIAlertAction *sixDays = [UIAlertAction
                              actionWithTitle:@"6 Days"
                              style:UIAlertActionStyleDefault
                              handler:^(UIAlertAction * action)
                              {
                                  LBDays.text = [NSString stringWithFormat:@"6 Days"];
                                  [alertview dismissViewControllerAnimated:YES completion:nil];
                              }];
    UIAlertAction *sevenDays = [UIAlertAction
                                actionWithTitle:@"7 Days"
                                style:UIAlertActionStyleDefault
                                handler:^(UIAlertAction * action)
                                {
                                    LBDays.text = [NSString stringWithFormat:@"7 Days"];
                                    [alertview dismissViewControllerAnimated:YES completion:nil];
                                }];
    UIAlertAction *cancel = [UIAlertAction
                             actionWithTitle:@"Cancel"
                             style:UIAlertActionStyleDestructive
                             handler:^(UIAlertAction * action)
                             {
                                 [alertview dismissViewControllerAnimated:YES completion:nil];
                             }];
    [alertview addAction:oneDays];
    [alertview addAction:twoDays];
    [alertview addAction:threeDays];
    [alertview addAction:fourDays];
    [alertview addAction:fiveDays];
    [alertview addAction:sixDays];
    [alertview addAction:sevenDays];
    [alertview addAction:cancel];
    [self presentViewController:alertview animated:YES completion:nil];
}

-(void)showDayPickers
{
    
    UIAlertController *alertview=   [UIAlertController
                                     alertControllerWithTitle:@"Select Days Availability "
                                     message:nil
                                     preferredStyle:UIAlertControllerStyleAlert];
    [alertview.view setTintColor:[UIColor blackColor]];
    
    UIViewController *controller = [[UIViewController alloc]init];
    
    arrDays = [[NSMutableArray alloc]initWithObjects:@"Sunday",@"Monday",@"Tuesday",@"Wednesday",@"Thursday",@"Friday",@"Saturday", nil];
    
    if (arrDays.count < 4)
    {
        CGRect rect = CGRectMake(0, 0, 272, 100);
        [controller setPreferredContentSize:rect.size];
        alertTableView  = [[UITableView alloc]initWithFrame:CGRectMake(0, 0, 272, 100)];
    }
    else if (arrDays.count < 6)
    {
        CGRect rect = CGRectMake(0, 0, 272, 150);
        [controller setPreferredContentSize:rect.size];
        alertTableView  = [[UITableView alloc]initWithFrame:CGRectMake(0, 0, 272, 150)];
    }
    else if (arrDays.count < 8)
    {
        CGRect rect = CGRectMake(0, 0, 272, 200);
        [controller setPreferredContentSize:rect.size];
        alertTableView  = [[UITableView alloc]initWithFrame:CGRectMake(0, 0, 272, 200)];
    }
    else
    {
        CGRect rect = CGRectMake(0, 0, 272, 250);
        [controller setPreferredContentSize:rect.size];
        alertTableView  = [[UITableView alloc]initWithFrame:CGRectMake(0, 0, 272, 250)];
    }
    
    alertTableView.delegate = self;
    alertTableView.dataSource = self;
    alertTableView.tableFooterView = [[UIView alloc]initWithFrame:CGRectZero];
    [alertTableView setSeparatorStyle:UITableViewCellSeparatorStyleSingleLine];
    [alertTableView setTag:15];
    [controller.view addSubview:alertTableView];
    [controller.view bringSubviewToFront:alertTableView];
    [controller.view setUserInteractionEnabled:YES];
    [alertTableView setUserInteractionEnabled:YES];
    [alertTableView setAllowsSelection:YES];
    
    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@"Title" message:@"Message" preferredStyle:UIAlertControllerStyleAlert];
    [alertController setValue:controller forKey:@"contentViewController"];
    UIAlertAction *cancelAction = [UIAlertAction actionWithTitle:@"Cancel" style:UIAlertActionStyleDestructive handler:^(UIAlertAction *action) {
    }];
    
    [alertController addAction:cancelAction];
    [self presentViewController:alertController animated:YES completion:nil];
    [alertController addChildViewController:controller];
    
}

@end
